

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>配置迁移指南 &mdash; AI PPT Assistant 1.0.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3bd3f67c" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=34088549"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=fd10adb8"></script>
      <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="prev" title="部署检查清单" href="deployment-checklist.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            AI PPT Assistant
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">用户指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/quickstart.html">快速开始</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">架构设计</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/architecture.html">系统架构</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">现有文档</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">API文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html#ai-ppt-assistant-api-documentation">AI PPT Assistant API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">部署文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#ai-ppt-assistant-deployment-guide">AI PPT Assistant - Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment-checklist.html">部署检查清单</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment-checklist.html#ai-ppt-assistant-deployment-checklist">AI PPT Assistant - Deployment Checklist</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">配置迁移指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="#config">🔧 环境变量到Config文件迁移指南</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">📋 概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">🎯 迁移优势</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">为什么要迁移？</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id5">🏗️ 新配置架构</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">目录结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">配置层次结构</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id8">🚀 迁移步骤</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#phase-1">Phase 1: 环境准备</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-2">Phase 2: 代码更新</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-3">Phase 3: 逐步替换</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-4">Phase 4: 部署更新</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id9">🔧 高级特性</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">1. 变量插值</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">2. 环境特定配置覆盖</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">3. 配置验证和类型安全</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id13">📊 迁移验证和测试</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">验证清单</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-b">A/B测试部署</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id15">🔒 安全考虑</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">敏感信息管理</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id17">🚨 故障排除</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id18">常见问题和解决方案</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id19">📈 性能优化</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id20">配置缓存策略</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lambda">Lambda冷启动优化</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id21">🎯 迁移时间线</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id22">✅ 迁移完成验证</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">最终检查清单</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AI PPT Assistant</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">配置迁移指南</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/existing/config-migration.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>配置迁移指南<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
</section>
<section id="config">
<h1>🔧 环境变量到Config文件迁移指南<a class="headerlink" href="#config" title="Link to this heading"></a></h1>
<section id="id2">
<h2>📋 概述<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>本指南提供了从环境变量配置模式迁移到YAML配置文件的完整方案。新的配置系统提供更好的可维护性、版本控制支持和环境管理。</p>
</section>
<section id="id3">
<h2>🎯 迁移优势<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<section id="id4">
<h3>为什么要迁移？<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>方面</p></th>
<th class="head"><p>环境变量</p></th>
<th class="head"><p>Config文件</p></th>
<th class="head"><p>改进</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>可维护性</strong></p></td>
<td><p>分散在42个文件中</p></td>
<td><p>集中化配置</p></td>
<td><p>✅ 90%减少维护复杂度</p></td>
</tr>
<tr class="row-odd"><td><p><strong>版本控制</strong></p></td>
<td><p>不易追踪变更</p></td>
<td><p>Git友好的YAML</p></td>
<td><p>✅ 完整的变更历史</p></td>
</tr>
<tr class="row-even"><td><p><strong>环境管理</strong></p></td>
<td><p>手动设置差异</p></td>
<td><p>环境特定文件</p></td>
<td><p>✅ 一键环境切换</p></td>
</tr>
<tr class="row-odd"><td><p><strong>类型安全</strong></p></td>
<td><p>字符串类型</p></td>
<td><p>强类型验证</p></td>
<td><p>✅ 运行时错误减少</p></td>
</tr>
<tr class="row-even"><td><p><strong>文档化</strong></p></td>
<td><p>注释困难</p></td>
<td><p>内置注释支持</p></td>
<td><p>✅ 自文档化配置</p></td>
</tr>
<tr class="row-odd"><td><p><strong>敏感信息</strong></p></td>
<td><p>明文存储</p></td>
<td><p>SSM/Secrets集成</p></td>
<td><p>✅ 安全性提升</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">★</span> <span class="pre">Insight</span> <span class="pre">─────────────────────────────────────</span></code>
关键架构改进：
• <strong>渐进式迁移</strong>：向后兼容，零停机时间迁移
• <strong>智能回退</strong>：Config文件 → 环境变量 → 默认值
• <strong>变量插值</strong>：支持 ${ENV:VAR}、${SSM:path}、${SECRET:name}
<code class="docutils literal notranslate"><span class="pre">─────────────────────────────────────────────────</span></code></p>
</section>
</section>
<section id="id5">
<h2>🏗️ 新配置架构<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<section id="id6">
<h3>目录结构<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>config/
├── default.yaml              # 基础配置模板
├── environments/
│   ├── dev.yaml              # 开发环境配置  
│   ├── staging.yaml          # 预发布环境配置
│   └── prod.yaml             # 生产环境配置
└── migration_report.md       # 迁移报告
</pre></div>
</div>
</section>
<section id="id7">
<h3>配置层次结构<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 配置优先级：环境特定 &gt; 默认配置 &gt; 环境变量 &gt; 硬编码默认值</span>
<span class="nt">aws</span><span class="p">:</span><span class="w">                          </span><span class="c1"># AWS基础设施配置</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;us-east-1&quot;</span>
<span class="w">  </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>

<span class="nt">services</span><span class="p">:</span><span class="w">                     </span><span class="c1"># 核心服务配置</span>
<span class="w">  </span><span class="nt">s3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ai-ppt-assistant-dev-presentations&quot;</span>
<span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span>
<span class="w">      </span><span class="nt">transition_to_ia_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">  </span>
<span class="w">  </span><span class="nt">dynamodb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ai-ppt-assistant-dev-sessions&quot;</span>
<span class="w">    </span><span class="nt">ttl_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
<span class="w">  </span>
<span class="w">  </span><span class="nt">bedrock</span><span class="p">:</span>
<span class="w">    </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;anthropic.claude-4-0&quot;</span>
<span class="w">    </span><span class="nt">orchestrator_agent_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SSM:/ai-ppt/agent/orchestrator-id}&quot;</span>

<span class="nt">performance</span><span class="p">:</span><span class="w">                  </span><span class="c1"># 性能配置</span>
<span class="w">  </span><span class="nt">lambda</span><span class="p">:</span>
<span class="w">    </span><span class="nt">memory_sizes</span><span class="p">:</span>
<span class="w">      </span><span class="nt">create_outline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
<span class="w">      </span><span class="nt">compile_pptx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3008</span>
<span class="w">  </span><span class="nt">max_concurrent_downloads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">cache_ttl_seconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span>

<span class="nt">security</span><span class="p">:</span><span class="w">                     </span><span class="c1"># 安全配置</span>
<span class="w">  </span><span class="nt">vpc_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">encryption_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">external_apis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pexels_api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SECRET:ai-ppt/pexels-key}&quot;</span>

<span class="nt">features</span><span class="p">:</span><span class="w">                     </span><span class="c1"># 功能开关</span>
<span class="w">  </span><span class="nt">enable_speaker_notes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">enable_image_generation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</section>
</section>
<section id="id8">
<h2>🚀 迁移步骤<a class="headerlink" href="#id8" title="Link to this heading"></a></h2>
<section id="phase-1">
<h3>Phase 1: 环境准备<a class="headerlink" href="#phase-1" title="Link to this heading"></a></h3>
<p><strong>1. 安装依赖</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加PyYAML支持</span>
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">PyYAML</span><span class="o">==</span><span class="m">6</span>.0.1

<span class="c1"># 更新Lambda层依赖</span>
<span class="nb">cd</span><span class="w"> </span>lambdas/layers
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;PyYAML==6.0.1&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>requirements.txt
./build.sh
</pre></div>
</div>
<p><strong>2. 运行迁移脚本</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 自动发现并迁移环境变量</span>
<span class="nb">cd</span><span class="w"> </span>scripts
python<span class="w"> </span>migrate_to_config.py<span class="w"> </span>--dry-run<span class="w">  </span><span class="c1"># 预览迁移结果</span>

<span class="c1"># 执行实际迁移</span>
python<span class="w"> </span>migrate_to_config.py<span class="w"> </span>--environments<span class="w"> </span>dev<span class="w"> </span>staging<span class="w"> </span>prod
</pre></div>
</div>
<p><strong>3. 验证生成的配置</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 检查生成的配置文件</span>
ls<span class="w"> </span>-la<span class="w"> </span>config/environments/
cat<span class="w"> </span>config/dev.yaml<span class="w">  </span><span class="c1"># 查看开发环境配置</span>
</pre></div>
</div>
</section>
<section id="phase-2">
<h3>Phase 2: 代码更新<a class="headerlink" href="#phase-2" title="Link to this heading"></a></h3>
<p><strong>更新Lambda函数示例</strong></p>
<p><strong>旧版本（环境变量）：</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 旧方式 - 分散的环境变量</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">MODEL_ID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;BEDROCK_MODEL_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;anthropic.claude-4-0&#39;</span><span class="p">)</span>
<span class="n">S3_BUCKET</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;S3_BUCKET&#39;</span><span class="p">,</span> <span class="s1">&#39;default-bucket&#39;</span><span class="p">)</span>
<span class="n">MAX_SLIDES</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MAX_SLIDES&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>新版本（Config文件）：</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 新方式 - 统一配置管理</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.enhanced_config_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_enhanced_config_manager</span>

<span class="n">config_manager</span> <span class="o">=</span> <span class="n">get_enhanced_config_manager</span><span class="p">()</span>
<span class="n">bedrock_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">get_bedrock_config</span><span class="p">()</span>
<span class="n">s3_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">get_s3_config</span><span class="p">()</span>
<span class="n">performance_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">get_performance_config</span><span class="p">()</span>

<span class="n">MODEL_ID</span> <span class="o">=</span> <span class="n">bedrock_config</span><span class="o">.</span><span class="n">model_id</span>
<span class="n">S3_BUCKET</span> <span class="o">=</span> <span class="n">s3_config</span><span class="o">.</span><span class="n">bucket</span>
<span class="n">MAX_SLIDES</span> <span class="o">=</span> <span class="n">performance_config</span><span class="o">.</span><span class="n">max_slides</span>
</pre></div>
</div>
</section>
<section id="phase-3">
<h3>Phase 3: 逐步替换<a class="headerlink" href="#phase-3" title="Link to this heading"></a></h3>
<p><strong>示例：更新 create_outline.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 在文件顶部添加</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.enhanced_config_manager</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_enhanced_config_manager</span><span class="p">,</span>
    <span class="n">get_enhanced_service_config</span><span class="p">,</span>
    <span class="n">get_enhanced_performance_config</span>
<span class="p">)</span>

<span class="c1"># 替换环境变量获取</span>
<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># 获取配置管理器</span>
    <span class="n">config_manager</span> <span class="o">=</span> <span class="n">get_enhanced_config_manager</span><span class="p">(</span>
        <span class="n">environment</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ENVIRONMENT&#39;</span><span class="p">,</span> <span class="s1">&#39;dev&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    
    <span class="c1"># 获取各类配置</span>
    <span class="n">bedrock_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">get_bedrock_config</span><span class="p">()</span>
    <span class="n">s3_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">get_s3_config</span><span class="p">()</span>
    <span class="n">performance_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">get_performance_config</span><span class="p">()</span>
    
    <span class="c1"># 使用类型化配置</span>
    <span class="n">MODEL_ID</span> <span class="o">=</span> <span class="n">bedrock_config</span><span class="o">.</span><span class="n">model_id</span>
    <span class="n">BUCKET_NAME</span> <span class="o">=</span> <span class="n">s3_config</span><span class="o">.</span><span class="n">bucket</span>
    <span class="n">MAX_SLIDES</span> <span class="o">=</span> <span class="n">performance_config</span><span class="o">.</span><span class="n">max_slides</span>
    
    <span class="c1"># 配置验证</span>
    <span class="n">validation_report</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">validate_configuration</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">validation_report</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Configuration validation failed&quot;</span><span class="p">,</span> 
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">validation_report</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]})</span>
        <span class="k">return</span> <span class="n">create_error_response</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;Configuration error&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="phase-4">
<h3>Phase 4: 部署更新<a class="headerlink" href="#phase-4" title="Link to this heading"></a></h3>
<p><strong>1. 更新Terraform配置</strong></p>
<div class="highlight-hcl notranslate"><div class="highlight"><pre><span></span><span class="c1"># infrastructure/main.tf</span>
<span class="c1"># 添加配置文件支持</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;config_files&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fileset</span><span class="p">(</span><span class="s2">&quot;${path.module}/../config/environments/&quot;, &quot;*.yaml&quot;</span><span class="p">)</span>
<span class="w">  </span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.config_bucket.bucket</span>
<span class="w">  </span><span class="na">key</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;config/${each.value}&quot;</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../config/environments/${each.value}&quot;</span>
<span class="w">  </span>
<span class="w">  </span><span class="na">etag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../config/environments/${each.value}&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># 环境变量传递配置文件位置</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;functions&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.lambda_functions</span>
<span class="w">  </span>
<span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">ENVIRONMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
<span class="w">      </span><span class="na">CONFIG_S3_BUCKET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.config_bucket.bucket</span>
<span class="w">      </span><span class="na">CONFIG_S3_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;config/${var.environment}.yaml&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>2. 更新部署脚本</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># 更新deploy.sh添加配置文件同步</span>

<span class="c1"># 同步配置文件到S3</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;📝 Uploading configuration files...&quot;</span>
aws<span class="w"> </span>s3<span class="w"> </span>sync<span class="w"> </span>config/<span class="w"> </span>s3://<span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span>-config-bucket/config/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--exclude<span class="w"> </span><span class="s2">&quot;*.md&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--exclude<span class="w"> </span><span class="s2">&quot;migration_report.md&quot;</span>

<span class="c1"># 验证配置文件</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;✅ Validating configuration...&quot;</span>
python<span class="w"> </span>scripts/validate_config.py<span class="w"> </span>--environment<span class="w"> </span><span class="si">${</span><span class="nv">ENVIRONMENT</span><span class="si">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id9">
<h2>🔧 高级特性<a class="headerlink" href="#id9" title="Link to this heading"></a></h2>
<section id="id10">
<h3>1. 变量插值<a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<p><strong>环境变量引用</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">aws</span><span class="p">:</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${ENV:AWS_REGION}&quot;</span><span class="w">  </span><span class="c1"># 从环境变量获取</span>
<span class="w">  </span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">s3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${ENV:PROJECT_NAME}-${ENV:ENVIRONMENT}-presentations&quot;</span>
</pre></div>
</div>
<p><strong>SSM参数引用</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bedrock</span><span class="p">:</span>
<span class="w">    </span><span class="nt">orchestrator_agent_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SSM:/ai-ppt-assistant/prod/bedrock/orchestrator-id}&quot;</span>
<span class="w">    </span><span class="nt">content_agent_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SSM:/ai-ppt-assistant/prod/bedrock/content-id}&quot;</span>
</pre></div>
</div>
<p><strong>Secrets Manager引用</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">security</span><span class="p">:</span>
<span class="w">  </span><span class="nt">external_apis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pexels_api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SECRET:ai-ppt-assistant/pexels-api-key}&quot;</span>
<span class="w">    </span><span class="nt">unsplash_access_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SECRET:ai-ppt-assistant/unsplash-key}&quot;</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>2. 环境特定配置覆盖<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<p><strong>开发环境优化</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># dev.yaml - 开发环境特定设置</span>
<span class="nt">performance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">lambda</span><span class="p">:</span>
<span class="w">    </span><span class="nt">memory_sizes</span><span class="p">:</span>
<span class="w">      </span><span class="nt">create_outline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span><span class="w">      </span><span class="c1"># 降低内存使用</span>
<span class="w">      </span><span class="nt">compile_pptx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span><span class="w">      </span><span class="c1"># 降低成本</span>
<span class="w">  </span>
<span class="w">  </span><span class="nt">cache_ttl_seconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w">       </span><span class="c1"># 更短的缓存时间</span>
<span class="w">  </span><span class="nt">max_slides</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">               </span><span class="c1"># 限制功能范围</span>

<span class="nt">development</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enable_debug_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">mock_bedrock_calls</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># 避免AI调用成本</span>
<span class="w">  </span><span class="nt">fast_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">              </span><span class="c1"># 跳过某些验证</span>
</pre></div>
</div>
<p><strong>生产环境优化</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># prod.yaml - 生产环境特定设置</span>
<span class="nt">performance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">lambda</span><span class="p">:</span>
<span class="w">    </span><span class="nt">memory_sizes</span><span class="p">:</span>
<span class="w">      </span><span class="nt">compile_pptx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3008</span><span class="w">       </span><span class="c1"># 最大内存支持复杂PPT</span>
<span class="w">    </span><span class="nt">reserved_concurrency</span><span class="p">:</span>
<span class="w">      </span><span class="nt">create_outline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">       </span><span class="c1"># 更高并发</span>
<span class="w">  </span>
<span class="nt">security</span><span class="p">:</span>
<span class="w">  </span><span class="nt">vpc_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">encryption_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">enable_monitoring</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">production</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backup_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">auto_scaling</span><span class="p">:</span>
<span class="w">    </span><span class="nt">target_utilization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">70</span>
<span class="w">    </span><span class="nt">max_capacity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</pre></div>
</div>
</section>
<section id="id12">
<h3>3. 配置验证和类型安全<a class="headerlink" href="#id12" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 自动配置验证</span>
<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">config_manager</span> <span class="o">=</span> <span class="n">get_enhanced_config_manager</span><span class="p">()</span>
    
    <span class="c1"># 验证配置完整性</span>
    <span class="n">validation_report</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">validate_configuration</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">validation_report</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Critical configuration errors found&quot;</span><span class="p">,</span> 
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">validation_report</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]})</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Configuration validation failed&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">validation_report</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Configuration warnings&quot;</span><span class="p">,</span> 
                      <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;warnings&quot;</span><span class="p">:</span> <span class="n">validation_report</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]})</span>
    
    <span class="c1"># 获取类型化配置</span>
    <span class="n">performance_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">get_performance_config</span><span class="p">()</span>
    
    <span class="c1"># IDE自动补全和类型检查</span>
    <span class="n">max_memory</span> <span class="o">=</span> <span class="n">performance_config</span><span class="o">.</span><span class="k">lambda</span><span class="o">.</span><span class="n">memory_sizes</span><span class="p">[</span><span class="s2">&quot;compile_pptx&quot;</span><span class="p">]</span>  <span class="c1"># 类型：int</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">performance_config</span><span class="o">.</span><span class="k">lambda</span><span class="o">.</span><span class="n">timeouts</span><span class="p">[</span><span class="s2">&quot;compile_pptx&quot;</span><span class="p">]</span>         <span class="c1"># 类型：int</span>
</pre></div>
</div>
</section>
</section>
<section id="id13">
<h2>📊 迁移验证和测试<a class="headerlink" href="#id13" title="Link to this heading"></a></h2>
<section id="id14">
<h3>验证清单<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. 配置文件语法验证</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import yaml; yaml.safe_load(open(&#39;config/environments/prod.yaml&#39;))&quot;</span>

<span class="c1"># 2. 配置完整性验证</span>
python<span class="w"> </span>scripts/validate_config.py<span class="w"> </span>--environment<span class="w"> </span>prod<span class="w"> </span>--strict

<span class="c1"># 3. 向后兼容性测试</span>
<span class="nv">ENV_VAR_MODE</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>python<span class="w"> </span>test_lambda_function.py
<span class="nv">CONFIG_FILE_MODE</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>python<span class="w"> </span>test_lambda_function.py

<span class="c1"># 4. 端到端功能测试</span>
make<span class="w"> </span>test-e2e<span class="w"> </span><span class="nv">ENVIRONMENT</span><span class="o">=</span>dev<span class="w"> </span><span class="nv">CONFIG_MODE</span><span class="o">=</span>file
</pre></div>
</div>
</section>
<section id="a-b">
<h3>A/B测试部署<a class="headerlink" href="#a-b" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 支持A/B测试的配置加载</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_config_with_fallback</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;支持渐进式迁移的配置获取&quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 尝试加载配置文件</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;USE_CONFIG_FILE&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_enhanced_config_manager</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file loading failed, falling back to env vars: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># 回退到原有的ConfigManager</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">utils.config_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_config_manager</span>
    <span class="k">return</span> <span class="n">get_config_manager</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id15">
<h2>🔒 安全考虑<a class="headerlink" href="#id15" title="Link to this heading"></a></h2>
<section id="id16">
<h3>敏感信息管理<a class="headerlink" href="#id16" title="Link to this heading"></a></h3>
<p><strong>1. Secrets Manager集成</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 生产环境配置</span>
<span class="nt">security</span><span class="p">:</span>
<span class="w">  </span><span class="nt">external_apis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pexels_api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SECRET:ai-ppt-assistant/prod/pexels-api-key}&quot;</span>
<span class="w">    </span><span class="nt">openai_api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SECRET:ai-ppt-assistant/prod/openai-api-key}&quot;</span>
<span class="w">    </span>
<span class="w">  </span><span class="nt">database</span><span class="p">:</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SECRET:ai-ppt-assistant/prod/db-password}&quot;</span>
</pre></div>
</div>
<p><strong>2. IAM权限更新</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;ssm:GetParameter&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;ssm:GetParameters&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ssm:*:*:parameter/ai-ppt-assistant/*&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;secretsmanager:GetSecretValue&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:secretsmanager:*:*:secret:ai-ppt-assistant/*&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>3. 配置文件加密</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用AWS KMS加密敏感配置</span>
aws<span class="w"> </span>kms<span class="w"> </span>encrypt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--key-id<span class="w"> </span>arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--plaintext<span class="w"> </span>fileb://config/environments/prod.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>text<span class="w"> </span>--query<span class="w"> </span>CiphertextBlob<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>config/environments/prod.yaml.encrypted
</pre></div>
</div>
</section>
</section>
<section id="id17">
<h2>🚨 故障排除<a class="headerlink" href="#id17" title="Link to this heading"></a></h2>
<section id="id18">
<h3>常见问题和解决方案<a class="headerlink" href="#id18" title="Link to this heading"></a></h3>
<p><strong>1. PyYAML导入失败</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 症状：ImportError: No module named &#39;yaml&#39;</span>
<span class="c1"># 解决方案：</span>
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">PyYAML</span><span class="o">==</span><span class="m">6</span>.0.1
<span class="c1"># 或者在Lambda层中确保包含PyYAML</span>
</pre></div>
</div>
<p><strong>2. 配置文件路径问题</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 症状：FileNotFoundError: config file not found</span>
<span class="c1"># 解决方案：显式指定配置目录</span>
<span class="n">config_manager</span> <span class="o">=</span> <span class="n">get_enhanced_config_manager</span><span class="p">(</span>
    <span class="n">environment</span><span class="o">=</span><span class="s1">&#39;prod&#39;</span><span class="p">,</span>
    <span class="n">config_dir</span><span class="o">=</span><span class="s1">&#39;/opt/python/config&#39;</span>  <span class="c1"># Lambda层中的路径</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>3. 变量插值失败</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 症状：配置值仍为 ${SSM:...} 字符串</span>
<span class="c1"># 解决方案：检查IAM权限和参数存在性</span>
aws<span class="w"> </span>ssm<span class="w"> </span>get-parameter<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;/ai-ppt-assistant/prod/bedrock/agent-id&quot;</span><span class="w"> </span>--with-decryption
</pre></div>
</div>
<p><strong>4. 类型转换错误</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 症状：Expected int but got str</span>
<span class="c1"># 解决方案：确保YAML类型正确</span>
<span class="nt">performance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">max_slides</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w">          </span><span class="c1"># ✅ 正确：整数</span>
<span class="w">  </span><span class="nt">max_slides</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20&quot;</span><span class="w">        </span><span class="c1"># ❌ 错误：字符串</span>
<span class="w">  </span><span class="nt">enable_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">      </span><span class="c1"># ✅ 正确：布尔值</span>
<span class="w">  </span><span class="nt">enable_cache</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w">    </span><span class="c1"># ❌ 错误：字符串</span>
</pre></div>
</div>
</section>
</section>
<section id="id19">
<h2>📈 性能优化<a class="headerlink" href="#id19" title="Link to this heading"></a></h2>
<section id="id20">
<h3>配置缓存策略<a class="headerlink" href="#id20" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">EnhancedConfigManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache_ttl</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5分钟缓存</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_loaded</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">get_config_with_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reload</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">force_reload</span> <span class="ow">or</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_loaded</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> 
            <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_loaded</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_ttl</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_configuration</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_loaded</span> <span class="o">=</span> <span class="n">now</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_cache</span>
</pre></div>
</div>
</section>
<section id="lambda">
<h3>Lambda冷启动优化<a class="headerlink" href="#lambda" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 全局初始化配置管理器</span>
<span class="n">config_manager</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_global_config_manager</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;复用配置管理器实例，减少冷启动时间&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">config_manager</span>
    <span class="k">if</span> <span class="n">config_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config_manager</span> <span class="o">=</span> <span class="n">get_enhanced_config_manager</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">config_manager</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># 复用全局配置管理器</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_global_config_manager</span><span class="p">()</span>
    
    <span class="c1"># ... Lambda函数逻辑</span>
</pre></div>
</div>
</section>
</section>
<section id="id21">
<h2>🎯 迁移时间线<a class="headerlink" href="#id21" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>阶段</p></th>
<th class="head"><p>持续时间</p></th>
<th class="head"><p>主要任务</p></th>
<th class="head"><p>风险级别</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Phase 1</strong></p></td>
<td><p>1-2天</p></td>
<td><p>环境准备、脚本执行、配置生成</p></td>
<td><p>低</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Phase 2</strong></p></td>
<td><p>3-5天</p></td>
<td><p>代码更新、单元测试、集成测试</p></td>
<td><p>中</p></td>
</tr>
<tr class="row-even"><td><p><strong>Phase 3</strong></p></td>
<td><p>2-3天</p></td>
<td><p>部署更新、A/B测试、监控设置</p></td>
<td><p>中高</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Phase 4</strong></p></td>
<td><p>1-2天</p></td>
<td><p>全量切换、验证、清理</p></td>
<td><p>低</p></td>
</tr>
</tbody>
</table>
<p><strong>总计：7-12天</strong></p>
</section>
<section id="id22">
<h2>✅ 迁移完成验证<a class="headerlink" href="#id22" title="Link to this heading"></a></h2>
<section id="id23">
<h3>最终检查清单<a class="headerlink" href="#id23" title="Link to this heading"></a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 所有环境的配置文件已生成并验证</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> PyYAML依赖已添加到Lambda层</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 至少2个Lambda函数已迁移并测试</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> A/B测试显示新配置系统工作正常</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 敏感信息已迁移到Secrets Manager</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 监控和告警正常工作</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 部署脚本已更新</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 团队成员已培训新配置系统</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 回退方案已准备并测试</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> 文档已更新</p></li>
</ul>
<p>恭喜！你已成功完成从环境变量到Config文件的迁移。新的配置系统将为你的项目带来更好的可维护性、安全性和可扩展性。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="deployment-checklist.html" class="btn btn-neutral float-left" title="部署检查清单" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2025, AI PPT Assistant Team。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>