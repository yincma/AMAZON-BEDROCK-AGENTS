# Checkov 配置文件
# AWS Infrastructure as Code 安全扫描配置

# 框架配置
framework:
  - terraform
  - cloudformation

# 检查配置
check:
  # AWS S3 安全检查
  - CKV_AWS_18  # S3 Bucket should have access logging configured
  - CKV_AWS_20  # S3 Bucket should not allow public READ access
  - CKV_AWS_21  # S3 Bucket should not allow public READ-WRITE access
  - CKV_AWS_56  # S3 Bucket should have access logging configured
  - CKV_AWS_57  # S3 Bucket should have object versioning enabled
  - CKV_AWS_58  # S3 Bucket should have public access restrictions configured
  - CKV_AWS_144 # Ensure S3 bucket has cross-region replication enabled
  - CKV_AWS_145 # Ensure S3 bucket MFA Delete is enabled

  # AWS Lambda 安全检查
  - CKV_AWS_50  # Lambda functions should have X-Ray tracing enabled
  - CKV_AWS_58  # Lambda functions should be deployed with dead letter queues
  - CKV_AWS_115 # Lambda function is configured for function-level concurrent execution limit
  - CKV_AWS_116 # Lambda function configured for dead letter queue(DLQ)
  - CKV_AWS_117 # Lambda function is configured for function-level concurrent execution limit
  - CKV_AWS_173 # Check encryption settings for Lambda environment variable

  # AWS IAM 安全检查
  - CKV_AWS_39  # Ensure IAM root access key does not exist
  - CKV_AWS_40  # Ensure IAM policies are attached only to groups or roles
  - CKV_AWS_60  # Ensure IAM role allows only specific services or principals
  - CKV_AWS_61  # Ensure IAM role allows only specific principals
  - CKV_AWS_62  # Ensure IAM roles do not have a trust policy with all principals
  - CKV_AWS_111 # Ensure IAM policy does not grant write access without constraints

  # AWS API Gateway 安全检查
  - CKV_AWS_73  # API Gateway has access logging configured
  - CKV_AWS_76  # API Gateway has X-Ray tracing enabled
  - CKV_AWS_120 # Ensure API Gateway caching is enabled and encrypted
  - CKV_AWS_165 # Ensure API Gateway has request validation enabled

  # AWS DynamoDB 安全检查
  - CKV_AWS_28  # DynamoDB table should have point-in-time recovery enabled
  - CKV_AWS_74  # DynamoDB table should be encrypted with AWS managed key
  - CKV_AWS_119 # DynamoDB table should be encrypted

  # AWS CloudWatch 安全检查
  - CKV_AWS_158 # CloudWatch log groups should be encrypted using AWS KMS keys
  - CKV_AWS_196 # CloudWatch log groups retention period should be at least 365 days

  # AWS VPC 安全检查
  - CKV_AWS_23  # Security group ingress rules should not allow traffic from 0.0.0.0/0 to port 22
  - CKV_AWS_24  # Security group ingress rules should not allow traffic from 0.0.0.0/0 to port 3389
  - CKV_AWS_25  # Security group rules should not allow ingress from 0.0.0.0/0 to all ports
  - CKV_AWS_260 # Ensure security group does not use '*' in ingress rules

# 跳过的检查（根据项目需求调整）
skip_check:
  # 开发环境可能需要跳过的检查
  - CKV_AWS_108  # Lambda function should not have admin privileges
  - CKV_AWS_109  # Lambda function should not have unrestricted outbound access

# 排除的目录和文件
exclude:
  - ".venv/**"
  - "venv/**"
  - "node_modules/**"
  - ".git/**"
  - "__pycache__/**"
  - "lambdas/layers/build/**"
  - "security/reports/**"
  - ".terraform/**"

# 严重性过滤器
severity: 
  - CRITICAL
  - HIGH
  - MEDIUM
  - LOW

# 输出格式
output: 
  - cli
  - json

# 安静模式（减少输出）
quiet: false

# 详细模式
verbose: 0

# 下载外部检查
download-external-modules: true

# 评估变量
evaluate-variables: true

# 外部检查目录
external-checks-dir: []

# 外部检查仓库
external-checks-git: []

# 创建基线文件
create-baseline: false

# 基线文件路径
baseline: null

# 软失败模式（不会导致非零退出代码）
soft-fail: false

# 硬失败模式（遇到错误时立即退出）
hard-fail-on: []

# 检查图表
check-graph: false

# 框架特定配置
framework-config:
  terraform:
    # Terraform 特定配置
    plan-file: null
    var-file: []
    compact-policy-tree: true
  
  cloudformation:
    # CloudFormation 特定配置
    nested-cf: true