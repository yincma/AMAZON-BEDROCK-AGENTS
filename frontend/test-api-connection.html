<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .config {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .config input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ AWS API Gateway è¿æ¥æµ‹è¯•</h1>
    
    <div class="config">
        <h2>é…ç½®</h2>
        <label>API URL:</label>
        <input type="text" id="apiUrl" value="https://taett6van5.execute-api.us-east-1.amazonaws.com/v1" />
        <label>API Key:</label>
        <input type="password" id="apiKey" value="mRStovr0hf9aBwoucts7a4dsZ5aBuPof34SSt2Lx" />
    </div>

    <div class="test-section">
        <h2>åŸºç¡€è¿æ¥æµ‹è¯•</h2>
        <button onclick="testHealth()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
        <button onclick="testReady()">æµ‹è¯•å°±ç»ªçŠ¶æ€</button>
        <button onclick="testTemplates()">è·å–æ¨¡æ¿åˆ—è¡¨</button>
        <button onclick="testPresentations()">è·å–æ¼”ç¤ºæ–‡ç¨¿åˆ—è¡¨</button>
        <div id="basicResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>åˆ›å»ºæ¼”ç¤ºæ–‡ç¨¿æµ‹è¯•</h2>
        <div class="form-group">
            <label>æ ‡é¢˜:</label>
            <input type="text" id="title" value="æµ‹è¯•æ¼”ç¤ºæ–‡ç¨¿" />
        </div>
        <div class="form-group">
            <label>ä¸»é¢˜:</label>
            <textarea id="topic">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¼”ç¤ºæ–‡ç¨¿ï¼Œç”¨äºéªŒè¯ API åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</textarea>
        </div>
        <div class="form-group">
            <label>è¯­è¨€:</label>
            <select id="language">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">English</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ko">í•œêµ­ì–´</option>
                <option value="es">EspaÃ±ol</option>
                <option value="fr">FranÃ§ais</option>
                <option value="de">Deutsch</option>
                <option value="pt">PortuguÃªs</option>
            </select>
        </div>
        <div class="form-group">
            <label>å¹»ç¯ç‰‡æ•°é‡:</label>
            <input type="number" id="slideCount" value="5" min="1" max="30" />
        </div>
        <div class="form-group">
            <label>é£æ ¼:</label>
            <select id="style">
                <option value="professional">ä¸“ä¸š</option>
                <option value="creative">åˆ›æ„</option>
                <option value="minimalist">ç®€çº¦</option>
                <option value="technical">æŠ€æœ¯</option>
                <option value="academic">å­¦æœ¯</option>
            </select>
        </div>
        <button onclick="createPresentation()">åˆ›å»ºæ¼”ç¤ºæ–‡ç¨¿</button>
        <div id="createResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢</h2>
        <div class="form-group">
            <label>ä»»åŠ¡ ID:</label>
            <input type="text" id="taskId" placeholder="è¾“å…¥ä»»åŠ¡ ID" />
        </div>
        <button onclick="checkTaskStatus()">æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€</button>
        <div id="taskResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const getConfig = () => ({
            url: document.getElementById('apiUrl').value,
            key: document.getElementById('apiKey').value
        });

        const makeRequest = async (method, path, data = null) => {
            const config = getConfig();
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': config.key
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(config.url + path, options);
                const text = await response.text();
                let result;
                
                try {
                    result = JSON.parse(text);
                } catch {
                    result = text;
                }
                
                return {
                    ok: response.ok,
                    status: response.status,
                    statusText: response.statusText,
                    data: result
                };
            } catch (error) {
                return {
                    ok: false,
                    error: error.message
                };
            }
        };

        const showResult = (elementId, success, message) => {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + (success ? 'success' : 'error');
            element.textContent = typeof message === 'object' 
                ? JSON.stringify(message, null, 2) 
                : message;
        };

        async function testHealth() {
            const result = await makeRequest('GET', '/health');
            showResult('basicResult', result.ok, 
                result.ok ? `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ\n${JSON.stringify(result.data, null, 2)}` 
                          : `âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${result.error || result.data}`);
        }

        async function testReady() {
            const result = await makeRequest('GET', '/health/ready');
            showResult('basicResult', result.ok, 
                result.ok ? `âœ… å°±ç»ªæ£€æŸ¥æˆåŠŸ\n${JSON.stringify(result.data, null, 2)}` 
                          : `âŒ å°±ç»ªæ£€æŸ¥å¤±è´¥: ${result.error || result.data}`);
        }

        async function testTemplates() {
            const result = await makeRequest('GET', '/templates');
            showResult('basicResult', result.ok, 
                result.ok ? `âœ… è·å–æ¨¡æ¿æˆåŠŸ\n${JSON.stringify(result.data, null, 2)}` 
                          : `âŒ è·å–æ¨¡æ¿å¤±è´¥: ${result.status} ${result.statusText}\n${JSON.stringify(result.data, null, 2)}`);
        }

        async function testPresentations() {
            const result = await makeRequest('GET', '/presentations');
            showResult('basicResult', result.ok, 
                result.ok ? `âœ… è·å–æ¼”ç¤ºæ–‡ç¨¿åˆ—è¡¨æˆåŠŸ\n${JSON.stringify(result.data, null, 2)}` 
                          : `âŒ è·å–æ¼”ç¤ºæ–‡ç¨¿åˆ—è¡¨å¤±è´¥: ${result.status} ${result.statusText}\n${JSON.stringify(result.data, null, 2)}`);
        }

        async function createPresentation() {
            const data = {
                title: document.getElementById('title').value,
                topic: document.getElementById('topic').value,
                language: document.getElementById('language').value,
                slide_count: parseInt(document.getElementById('slideCount').value),
                style: document.getElementById('style').value
            };
            
            const result = await makeRequest('POST', '/presentations', data);
            
            if (result.ok) {
                showResult('createResult', true, 
                    `âœ… åˆ›å»ºæˆåŠŸï¼\n${JSON.stringify(result.data, null, 2)}`);
                
                // å¦‚æœè¿”å›äº†ä»»åŠ¡ IDï¼Œè‡ªåŠ¨å¡«å……åˆ°ä»»åŠ¡æŸ¥è¯¢æ¡†
                if (result.data && result.data.task_id) {
                    document.getElementById('taskId').value = result.data.task_id;
                }
            } else {
                showResult('createResult', false, 
                    `âŒ åˆ›å»ºå¤±è´¥: ${result.status} ${result.statusText}\n${JSON.stringify(result.data, null, 2)}`);
            }
        }

        async function checkTaskStatus() {
            const taskId = document.getElementById('taskId').value;
            if (!taskId) {
                showResult('taskResult', false, 'è¯·è¾“å…¥ä»»åŠ¡ ID');
                return;
            }
            
            const result = await makeRequest('GET', `/tasks/${taskId}`);
            showResult('taskResult', result.ok, 
                result.ok ? `âœ… ä»»åŠ¡çŠ¶æ€\n${JSON.stringify(result.data, null, 2)}` 
                          : `âŒ æŸ¥è¯¢å¤±è´¥: ${result.status} ${result.statusText}\n${JSON.stringify(result.data, null, 2)}`);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•å¥åº·çŠ¶æ€
        window.onload = () => {
            testHealth();
        };
    </script>
</body>
</html>