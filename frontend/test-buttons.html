<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>按钮测试页面</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            background: #3b82f6;
            color: white;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .success { background: #10b981; }
        .error { background: #ef4444; }
        .warning { background: #f59e0b; }
        #console {
            background: #000;
            color: #0f0;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
            margin-top: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.ok { background: #d1fae5; color: #065f46; }
        .status.error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <h1>前端按钮功能测试</h1>
    
    <div class="test-section">
        <h2>基础按钮测试</h2>
        <button class="test-button" onclick="testClick()">点击测试</button>
        <button class="test-button success" onclick="testSuccess()">成功操作</button>
        <button class="test-button error" onclick="testError()">错误操作</button>
        <button class="test-button warning" onclick="testWarning()">警告操作</button>
    </div>

    <div class="test-section">
        <h2>应用功能测试</h2>
        <button class="test-button" onclick="testNavigate()">导航测试</button>
        <button class="test-button" onclick="testAPICall()">API调用测试</button>
        <button class="test-button" onclick="testStorage()">本地存储测试</button>
        <button class="test-button" onclick="checkAppStatus()">检查应用状态</button>
    </div>

    <div class="test-section">
        <h2>浏览器控制台检查</h2>
        <button class="test-button" onclick="checkConsoleErrors()">检查控制台错误</button>
        <button class="test-button" onclick="clearConsole()">清空控制台</button>
    </div>

    <div id="status" class="status"></div>
    
    <div id="console"></div>

    <script>
        const consoleEl = document.getElementById('console');
        const statusEl = document.getElementById('status');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '❌' : type === 'success' ? '✅' : 'ℹ️';
            consoleEl.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
            
            // 同时输出到浏览器控制台
            if (type === 'error') {
                console.error(message);
            } else {
                console.log(message);
            }
        }

        function updateStatus(message, isError = false) {
            statusEl.className = `status ${isError ? 'error' : 'ok'}`;
            statusEl.textContent = message;
        }

        function testClick() {
            log('按钮点击成功！事件处理程序正常工作', 'success');
            updateStatus('基础点击测试通过');
        }

        function testSuccess() {
            log('成功操作执行', 'success');
            updateStatus('成功操作测试通过');
        }

        function testError() {
            log('错误操作执行（这是一个测试错误）', 'error');
            updateStatus('错误处理测试通过', true);
            setTimeout(() => updateStatus('就绪'), 2000);
        }

        function testWarning() {
            log('警告操作执行', 'warning');
            updateStatus('警告处理测试通过');
        }

        function testNavigate() {
            log('测试页面导航...');
            // 模拟React Router导航
            window.history.pushState({}, '', '/test-navigation');
            log('导航到: ' + window.location.pathname, 'success');
            setTimeout(() => {
                window.history.back();
                log('返回原页面', 'success');
            }, 1000);
        }

        async function testAPICall() {
            log('测试API调用...');
            try {
                const response = await fetch('http://localhost:5173/api/test', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    log('API调用成功', 'success');
                } else {
                    log(`API调用返回状态: ${response.status}`, 'warning');
                }
            } catch (error) {
                log(`API调用失败: ${error.message}`, 'error');
                log('这是预期的，因为测试端点可能不存在', 'info');
            }
        }

        function testStorage() {
            log('测试本地存储...');
            const testData = { test: true, timestamp: Date.now() };
            
            // 测试 localStorage
            localStorage.setItem('test-data', JSON.stringify(testData));
            const retrieved = JSON.parse(localStorage.getItem('test-data'));
            
            if (retrieved && retrieved.test === true) {
                log('localStorage 工作正常', 'success');
            } else {
                log('localStorage 测试失败', 'error');
            }
            
            // 测试 sessionStorage
            sessionStorage.setItem('test-session', 'test-value');
            if (sessionStorage.getItem('test-session') === 'test-value') {
                log('sessionStorage 工作正常', 'success');
            } else {
                log('sessionStorage 测试失败', 'error');
            }
            
            updateStatus('存储测试完成');
        }

        async function checkAppStatus() {
            log('检查React应用状态...');
            
            // 检查React应用是否加载
            const reactRoot = document.getElementById('root');
            if (!reactRoot) {
                log('React根元素不存在', 'error');
                updateStatus('应用未正确加载', true);
                return;
            }
            
            // 检查应用是否渲染
            if (reactRoot.children.length === 0) {
                log('React应用未渲染内容', 'error');
                updateStatus('应用渲染失败', true);
                return;
            }
            
            // 尝试访问应用页面
            try {
                const response = await fetch('http://localhost:5173/dashboard');
                if (response.ok) {
                    log('Dashboard页面可访问', 'success');
                    
                    // 检查页面内容
                    const text = await response.text();
                    if (text.includes('root')) {
                        log('页面HTML结构正常', 'success');
                    }
                } else {
                    log(`Dashboard页面返回状态: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`无法访问应用: ${error.message}`, 'error');
            }
            
            updateStatus('应用状态检查完成');
        }

        function checkConsoleErrors() {
            log('检查浏览器控制台错误...');
            
            // 保存原始console.error
            const originalError = console.error;
            let errorCount = 0;
            
            // 临时重写console.error来捕获错误
            console.error = function() {
                errorCount++;
                originalError.apply(console, arguments);
                log(`捕获控制台错误: ${Array.from(arguments).join(' ')}`, 'error');
            };
            
            // 恢复原始console.error
            setTimeout(() => {
                console.error = originalError;
                if (errorCount === 0) {
                    log('未检测到控制台错误', 'success');
                    updateStatus('控制台检查通过');
                } else {
                    log(`检测到 ${errorCount} 个控制台错误`, 'warning');
                    updateStatus(`发现 ${errorCount} 个错误`, true);
                }
            }, 100);
        }

        function clearConsole() {
            consoleEl.innerHTML = '';
            log('控制台已清空', 'success');
            updateStatus('就绪');
        }

        // 页面加载时自动检查
        window.addEventListener('load', () => {
            log('测试页面加载完成', 'success');
            log('点击上面的按钮进行各项测试', 'info');
            updateStatus('就绪');
            
            // 监听全局错误
            window.addEventListener('error', (event) => {
                log(`全局错误: ${event.message} at ${event.filename}:${event.lineno}:${event.colno}`, 'error');
            });
            
            // 监听未处理的Promise拒绝
            window.addEventListener('unhandledrejection', (event) => {
                log(`未处理的Promise拒绝: ${event.reason}`, 'error');
            });
        });
    </script>
</body>
</html>