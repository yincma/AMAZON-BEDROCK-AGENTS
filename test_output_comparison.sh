#!/bin/bash

# æµ‹è¯•è¾“å‡ºç²¾ç®€æ•ˆæœçš„å¯¹æ¯”è„šæœ¬

echo "=========================================="
echo "ğŸ“Š éƒ¨ç½²è¾“å‡ºå¯¹æ¯”æµ‹è¯•"
echo "=========================================="
echo ""

# æ¨¡æ‹ŸåŸå§‹è¾“å‡º
echo "1ï¸âƒ£ åŸå§‹è¾“å‡ºç¤ºä¾‹ï¼ˆè¯¦ç»†ç‰ˆï¼‰ï¼š"
echo "----------------------------------------"
echo "Building Lambda layer with requirements.txt..."
echo "Collecting boto3==1.26.137"
echo "  Downloading boto3-1.26.137-py3-none-any.whl (135 kB)"
echo "     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 135.6/135.6 kB 2.3 MB/s eta 0:00:00"
echo "Collecting botocore==1.29.137"
echo "  Downloading botocore-1.29.137-py3-none-any.whl (10.9 MB)"
echo "     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 10.9/10.9 MB 11.2 MB/s eta 0:00:00"
echo "Successfully installed boto3-1.26.137 botocore-1.29.137..."
echo "Packaging API function: generate_presentation..."
echo "Packaging API function: get_task..."
echo "Packaging API function: list_presentations..."
echo "... (è¿˜æœ‰19ä¸ªå‡½æ•°è¾“å‡º)"
echo "Creating aws_lambda_function.generate_presentation..."
echo "Creating aws_lambda_function.get_task..."
echo "... (Terraform åˆ›å»º100+èµ„æº)"
echo ""

echo "2ï¸âƒ£ ç²¾ç®€è¾“å‡ºç¤ºä¾‹ï¼ˆæ–°ç‰ˆï¼‰ï¼š"
echo "----------------------------------------"
echo "ğŸ”¨ Building optimized Lambda layers..."
echo "  âœ… Minimal layer built: 8MB"
echo "  âœ… Content layer built: 22MB"
echo "  âœ… Legacy layer built: 45MB"
echo "ğŸ“¦ Packaging Lambda functions..."
echo "  ğŸ“‚ API functions: 8 | Controller functions: 14"
echo "  âœ… Lambda functions packaged"
echo "ğŸš€ Deploying infrastructure with Terraform..."
echo "  Apply complete! Resources: 45 added, 0 changed, 0 destroyed."
echo "ğŸ”§ æ›´æ–°APIé…ç½®..."
echo "  âœ… API Gateway URL: https://xxx.execute-api.us-east-1.amazonaws.com/legacy"
echo "  âœ… API Key: abcd****wxyz"
echo ""

echo "=========================================="
echo "ğŸ“ˆ è¾“å‡ºå¯¹æ¯”æ€»ç»“ï¼š"
echo "=========================================="
echo "â€¢ åŸå§‹è¾“å‡º: ~200-300è¡Œ"
echo "â€¢ ç²¾ç®€è¾“å‡º: ~15-20è¡Œ"
echo "â€¢ å‡å°‘æ¯”ä¾‹: çº¦90%"
echo "â€¢ ä¿ç•™ä¿¡æ¯: æ‰€æœ‰å…³é”®çŠ¶æ€å’Œé…ç½®"
echo ""
echo "ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š"
echo "â€¢ make deploy-with-config         - ç²¾ç®€è¾“å‡ºï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰"
echo "â€¢ make deploy-with-config-verbose - è¯¦ç»†è¾“å‡ºï¼ˆè°ƒè¯•æ—¶ä½¿ç”¨ï¼‰"
echo ""